<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleados - RRHH</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<header>
    <p>SISTEMA DE RRHH</p>
    <nav>
        <a href="empleados.html">Lista de Empleados</a>
        <a href="denuncias.html">Denuncias</a>
    </nav>
</header>

<main>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Buscar empleado...">
    </div>

    <!-- Listado de empleados din√°mico -->
    <div id="empleados-list"></div>

    <div class="bottom-right">
        <a href="agregar_empleado.html" class="btn">Agregar Empleado</a>
    </div>
</main>

<div class="logout">
    <button class="btn btn-red">Cerrar Sesi√≥n</button>
</div>

<footer>
    <p>Todos los Derechos Reservados 2025 &copy;</p>
</footer>

<script>
    // Funci√≥n para traer empleados desde el backend
    function fetchEmpleados() {
        fetch("http://localhost:8080/api/empleados", {
            headers: {
                "Authorization": "Basic " + btoa("admin:Password123") // reemplaza por tus credenciales
            }
        })
            .then(res => res.json())
            .then(data => renderEmpleados(data))
            .catch(err => console.error("Error cargando empleados:", err));
    }

    // Funci√≥n para renderizar los empleados en la p√°gina
    function renderEmpleados(empleados) {
        const contenedor = document.getElementById("empleados-list");
        contenedor.innerHTML = ""; // limpiar lista previa

        empleados.forEach(emp => {
            const card = document.createElement("div");
            card.classList.add("card");

            card.innerHTML = `
                <div>
                    <strong>${emp.nombre} ${emp.apellido}</strong><br>
                    DNI: ${emp.dni}<br>
                    Fecha Nacimiento: ${emp.fechaNacimiento}<br>
                    Email: ${emp.email}<br>
                    Tel√©fono: ${emp.telefono}<br>
                    Puesto: ${emp.puesto ? emp.puesto.nombre : "Sin asignar"}<br>
                    Salario: $${emp.salario}
                </div>
                <div class="actions">
                    <button class="editar" data-id="${emp.id}">‚úèÔ∏è</button>
                    <button class="eliminar" data-id="${emp.id}">üóëÔ∏è</button>
                </div>
            `;

            contenedor.appendChild(card);
        });

        document.querySelectorAll(".editar").forEach(btn => {
            btn.addEventListener("click", function() {
                const id = this.getAttribute("data-id");
                sessionStorage.setItem("editarEmpleadoId", id);
                window.location.href = "agregar_empleado.html";
            });
        });

        // Asignar eventos de eliminar
        document.querySelectorAll(".eliminar").forEach(btn => {
            btn.addEventListener("click", async function() {
                const id = this.getAttribute("data-id");
                if (confirm("¬øSeguro que quieres eliminar este empleado?")) {
                    try {
                        const response = await fetch(`http://localhost:8080/api/empleados/${id}`, {
                            method: "DELETE",
                            headers: {
                                "Authorization": "Basic " + btoa("admin:Password123")
                            }
                        });
                        if (response.ok) {
                            alert("Empleado eliminado correctamente ‚úÖ");
                            fetchEmpleados();
                        } else {
                            alert("Error al eliminar el empleado");
                        }
                    } catch (error) {
                        console.error(error);
                        alert("No se pudo conectar con el servidor.");
                    }
                }
            });
        });
    }

    // B√∫squeda en vivo
    document.getElementById("searchInput").addEventListener("input", function() {
        const filtro = this.value.toLowerCase();
        document.querySelectorAll(".card").forEach(card => {
            const texto = card.innerText.toLowerCase();
            card.style.display = texto.includes(filtro) ? "" : "none";
        });
    });

    // L√≥gica para cerrar sesi√≥n
    document.querySelector(".logout .btn-red").addEventListener("click", function() {
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = "index.html";
    });

    // Llamada inicial
    fetchEmpleados();
</script>
</body>
</html>
